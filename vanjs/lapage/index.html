<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <title></title>
    <meta content="" name="description">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/vanjs-org/van/public/van-1.2.6.nomodule.min.js"
            type="text/javascript"></script>
    <script type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/vanjs-ext@0.1.3/dist/van-x.nomodule.min.js"></script>
    <script type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/vanjs-ui@0.10.0/dist/van-ui.nomodule.min.js"></script>
    <meta content="#fafafa" name="theme-color">
</head>

<body>

<div class="grid">
    <div id="formColumn"></div>
    <div id="jsonColumn"></div>
</div>
<script>
    const {button, div, ul, li, pre, form, textArea, input, p, label} = van.tags
    const errorValue = van.state("")


    let dataList = vanX.reactive([{a: 5, b: 3}, {a: 3, b: 4}])
    let jsValHolder =vanX.reactive({})
    jsValHolder.jsonValue = vanX.calc(() => JSON.stringify(dataList.filter(_ => 1), null, 2))


    const board = new MessageBoard({top: "20px"})
    const showTextCopied = () => board.show({message: "Text Copied", durationSec: 1})
    van.add(document.body, board)


    const replaceDataListWithJson = (js) => {
        try {
            let parse = JSON.parse(js);
            errorValue.val = "";
            vanX.replace(dataList, l => parse)
        } catch (e) {
            errorValue.val = e.message;
            console.log(e)
        }
    }
    const result = () => {
        //let s= van.derive(()=>)
        // return pre(p(() => jsValHolder.jsonValue))
        return div({style: "min-height:99vh;height:100%;"},

            div({style: 'color:red;'}, () => errorValue.val),
            button({onclick: () => navigator.clipboard.writeText(jsValHolder.jsonValue).then(() => showTextCopied())}, "copy"),
            textArea({
                oninput: e => replaceDataListWithJson(e.target.value), style: "height:99%;", value: () => {
                    console.log("az", jsValHolder.jsonValue);
                    return jsValHolder.jsonValue
                }
            })
        )
    }
    const inputField = (displayName, v) => {
        return label({for: displayName},
            displayName,
            input({
                type: "text",
                id: displayName,
                name: displayName,
                placeholder: displayName,
                value: v,
                oninput: e => v.val = e.target.value
            }),
        )

        //  return input({value: v, oninput: e => v.val = e.target.value})
    }

    const formValue=(a,b)=>{
        return {a:a,b:b}
    }
    const formFiled = (elem,deleter) => {
        console.log("formField",elem)
        return div({}, [
            div({style:'display:flex;justify-content:end;'},div({onclick:deleter},"delete me")),
            inputField("a", vanX.stateFields(elem.val).a),
            inputField("b", vanX.stateFields(elem.val).b),

            ]
        )
    }

    let compo = vanX.list(ul, dataList, (v,deleter) => formFiled(v,deleter))
    van.add(document.body, board)
    van.add(document.getElementById("formColumn"), div({onclick:()=>dataList.unshift(formValue("XX",""))},"new") ,compo)

    van.add(document.getElementById("jsonColumn"), result())
</script>

</body>

</html>
